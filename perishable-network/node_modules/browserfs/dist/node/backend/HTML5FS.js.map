{"version":3,"file":"HTML5FS.js","sourceRoot":"","sources":["../../../src/backend/HTML5FS.ts"],"names":[],"mappings":"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","sourcesContent":["import PreloadFile from '../generic/preload_file';\nimport {BaseFileSystem, FileSystem as IFileSystem} from '../core/file_system';\nimport {ApiError, ErrorCode} from '../core/api_error';\nimport {FileFlag, ActionType} from '../core/file_flag';\nimport {default as Stats, FileType} from '../core/node_fs_stats';\nimport {File as IFile} from '../core/file';\nimport * as path from 'path';\nimport global from '../core/global';\nimport {each as asyncEach} from 'async';\nimport {buffer2ArrayBuffer, arrayBuffer2Buffer} from '../core/util';\n\nfunction isDirectoryEntry(entry: Entry): entry is DirectoryEntry {\n  return entry.isDirectory;\n}\n\nconst _getFS: (type: number, size: number, successCallback: FileSystemCallback, errorCallback?: ErrorCallback) => void = global.webkitRequestFileSystem || global.requestFileSystem || null;\n\nfunction _requestQuota(type: number, size: number, success: (size: number) => void, errorCallback: ErrorCallback) {\n  // We cast navigator and window to '<any>' because everything here is\n  // nonstandard functionality, despite the fact that Chrome has the only\n  // implementation of the HTML5FS and is likely driving the standardization\n  // process. Thus, these objects defined off of navigator and window are not\n  // present in the DefinitelyTyped TypeScript typings for FileSystem.\n  if (typeof (<any> navigator)['webkitPersistentStorage'] !== 'undefined') {\n    switch (type) {\n      case global.PERSISTENT:\n        (<any> navigator).webkitPersistentStorage.requestQuota(size, success, errorCallback);\n        break;\n      case global.TEMPORARY:\n        (<any> navigator).webkitTemporaryStorage.requestQuota(size, success, errorCallback);\n        break;\n      default:\n        errorCallback(new TypeError(`Invalid storage type: ${type}`));\n        break;\n    }\n  } else {\n    (<any> global).webkitStorageInfo.requestQuota(type, size, success, errorCallback);\n  }\n}\n\nfunction _toArray(list?: any[]): any[] {\n  return Array.prototype.slice.call(list || [], 0);\n}\n\n/**\n * Converts the given DOMError into an appropriate ApiError.\n * Full list of values here:\n * https://developer.mozilla.org/en-US/docs/Web/API/DOMError\n */\nfunction convertError(err: DOMError, p: string, expectedDir: boolean): ApiError {\n  switch (err.name) {\n    /* The user agent failed to create a file or directory due to the existence of a file or\n        directory with the same path.  */\n    case \"PathExistsError\":\n      return ApiError.EEXIST(p);\n    /* The operation failed because it would cause the application to exceed its storage quota.  */\n    case 'QuotaExceededError':\n      return ApiError.FileError(ErrorCode.ENOSPC, p);\n    /*  A required file or directory could not be found at the time an operation was processed.   */\n    case 'NotFoundError':\n      return ApiError.ENOENT(p);\n    /* This is a security error code to be used in situations not covered by any other error codes.\n        - A required file was unsafe for access within a Web application\n        - Too many calls are being made on filesystem resources */\n    case 'SecurityError':\n      return ApiError.FileError(ErrorCode.EACCES, p);\n    /* The modification requested was illegal. Examples of invalid modifications include moving a\n        directory into its own child, moving a file into its parent directory without changing its name,\n        or copying a directory to a path occupied by a file.  */\n    case 'InvalidModificationError':\n      return ApiError.FileError(ErrorCode.EPERM, p);\n    /* The user has attempted to look up a file or directory, but the Entry found is of the wrong type\n        [e.g. is a DirectoryEntry when the user requested a FileEntry].  */\n    case 'TypeMismatchError':\n      return ApiError.FileError(expectedDir ? ErrorCode.ENOTDIR : ErrorCode.EISDIR, p);\n    /* A path or URL supplied to the API was malformed.  */\n    case \"EncodingError\":\n    /* An operation depended on state cached in an interface object, but that state that has changed\n        since it was read from disk.  */\n    case \"InvalidStateError\":\n    /* The user attempted to write to a file or directory which could not be modified due to the state\n        of the underlying filesystem.  */\n    case \"NoModificationAllowedError\":\n    default:\n      return ApiError.FileError(ErrorCode.EINVAL, p);\n  }\n}\n\n// A note about getFile and getDirectory options:\n// These methods are called at numerous places in this file, and are passed\n// some combination of these two options:\n//   - create: If true, the entry will be created if it doesn't exist.\n//             If false, an error will be thrown if it doesn't exist.\n//   - exclusive: If true, only create the entry if it doesn't already exist,\n//                and throw an error if it does.\n\nexport class HTML5FSFile extends PreloadFile<HTML5FS> implements IFile {\n  private _entry: FileEntry;\n\n  constructor(fs: HTML5FS, entry: FileEntry, path: string, flag: FileFlag, stat: Stats, contents?: Buffer) {\n    super(fs, path, flag, stat, contents);\n    this._entry = entry;\n  }\n\n  public sync(cb: (e?: ApiError) => void): void {\n    if (!this.isDirty()) {\n      return cb();\n    }\n\n    this._entry.createWriter((writer) => {\n      let buffer = this.getBuffer();\n      let blob = new Blob([buffer2ArrayBuffer(buffer)]);\n      let length = blob.size;\n      writer.onwriteend = (err?: any) => {\n        writer.onwriteend = null;\n        writer.onerror = null;\n        writer.truncate(length);\n        this.resetDirty();\n        cb();\n      };\n      writer.onerror = (err: any) => {\n        cb(convertError(err, this.getPath(), false));\n      };\n      writer.write(blob);\n    });\n  }\n\n  public close(cb: (e?: ApiError) => void): void {\n    this.sync(cb);\n  }\n}\n\nexport default class HTML5FS extends BaseFileSystem implements IFileSystem {\n  public static isAvailable(): boolean {\n    return !!_getFS;\n  }\n\n  // HTML5File reaches into HTML5FS. :/\n  public fs: FileSystem;\n  private size: number;\n  private type: number;\n  /**\n   * Arguments:\n   *   - type: PERSISTENT or TEMPORARY\n   *   - size: storage quota to request, in megabytes. Allocated value may be less.\n   */\n  constructor(size: number = 5, type: number = global.PERSISTENT) {\n    super();\n    // Convert MB to bytes.\n    this.size = 1024 * 1024 * size;\n    this.type = type;\n  }\n\n  public getName(): string {\n    return 'HTML5 FileSystem';\n  }\n\n  public isReadOnly(): boolean {\n    return false;\n  }\n\n  public supportsSymlinks(): boolean {\n    return false;\n  }\n\n  public supportsProps(): boolean {\n    return false;\n  }\n\n  public supportsSynch(): boolean {\n    return false;\n  }\n\n  /**\n   * Nonstandard\n   * Requests a storage quota from the browser to back this FS.\n   */\n  public allocate(cb: (e?: ApiError) => void = () => {/*nop*/}): void {\n    let success = (fs: FileSystem): void => {\n      this.fs = fs;\n      cb();\n    };\n    let error = (err: DOMException): void => {\n      cb(convertError(err, \"/\", true));\n    };\n    if (this.type === global.PERSISTENT) {\n      _requestQuota(this.type, this.size, (granted: number) => {\n        _getFS(this.type, granted, success, error);\n      }, error);\n    } else {\n      _getFS(this.type, this.size, success, error);\n    }\n  }\n\n  /**\n   * Nonstandard\n   * Deletes everything in the FS. Used for testing.\n   * Karma clears the storage after you quit it but not between runs of the test\n   * suite, and the tests expect an empty FS every time.\n   */\n  public empty(mainCb: (e?: ApiError) => void): void {\n    // Get a list of all entries in the root directory to delete them\n    this._readdir('/', (err: ApiError, entries?: Entry[]): void => {\n      if (err) {\n        console.error('Failed to empty FS');\n        mainCb(err);\n      } else {\n        // Called when every entry has been operated on\n        let finished = (er: any): void => {\n          if (err) {\n            console.error(\"Failed to empty FS\");\n            mainCb(err);\n          } else {\n            mainCb();\n          }\n        };\n        // Removes files and recursively removes directories\n        let deleteEntry = (entry: Entry, cb: (e?: any) => void): void => {\n          let succ = () => {\n            cb();\n          };\n          let error = (err: DOMException) => {\n            cb(convertError(err, entry.fullPath, !entry.isDirectory));\n          };\n          if (isDirectoryEntry(entry)) {\n            entry.removeRecursively(succ, error);\n          } else {\n            entry.remove(succ, error);\n          }\n        };\n        // Loop through the entries and remove them, then call the callback\n        // when they're all finished.\n        asyncEach(entries, deleteEntry, finished);\n      }\n    });\n  }\n\n  public rename(oldPath: string, newPath: string, cb: (e?: ApiError) => void): void {\n    let semaphore: number = 2,\n      successCount: number = 0,\n      root: DirectoryEntry = this.fs.root,\n      currentPath: string = oldPath,\n      error = (err: DOMException): void => {\n        if (--semaphore <= 0) {\n            cb(convertError(err, currentPath, false));\n        }\n      },\n      success = (file: Entry): void => {\n        if (++successCount === 2) {\n          return cb(new ApiError(ErrorCode.EINVAL, \"Something was identified as both a file and a directory. This should never happen.\"));\n        }\n\n        // SPECIAL CASE: If newPath === oldPath, and the path exists, then\n        // this operation trivially succeeds.\n        if (oldPath === newPath) {\n          return cb();\n        }\n\n        // Get the new parent directory.\n        currentPath = path.dirname(newPath);\n        root.getDirectory(currentPath, {}, (parentDir: DirectoryEntry): void => {\n          currentPath = path.basename(newPath);\n          file.moveTo(parentDir, currentPath, (entry: Entry): void => { cb(); }, (err: DOMException): void => {\n            // SPECIAL CASE: If oldPath is a directory, and newPath is a\n            // file, rename should delete the file and perform the move.\n            if (file.isDirectory) {\n              currentPath = newPath;\n              // Unlink only works on files. Try to delete newPath.\n              this.unlink(newPath, (e?): void => {\n                if (e) {\n                  // newPath is probably a directory.\n                  error(err);\n                } else {\n                  // Recur, now that newPath doesn't exist.\n                  this.rename(oldPath, newPath, cb);\n                }\n              });\n            } else {\n              error(err);\n            }\n          });\n        }, error);\n      };\n\n    // We don't know if oldPath is a *file* or a *directory*, and there's no\n    // way to stat items. So launch both requests, see which one succeeds.\n    root.getFile(oldPath, {}, success, error);\n    root.getDirectory(oldPath, {}, success, error);\n  }\n\n  public stat(path: string, isLstat: boolean, cb: (err: ApiError, stat?: Stats) => void): void {\n    // Throw an error if the entry doesn't exist, because then there's nothing\n    // to stat.\n    let opts = {\n      create: false\n    };\n    // Called when the path has been successfully loaded as a file.\n    let loadAsFile = (entry: FileEntry): void => {\n      let fileFromEntry = (file: File): void => {\n        let stat = new Stats(FileType.FILE, file.size);\n        cb(null, stat);\n      };\n      entry.file(fileFromEntry, failedToLoad);\n    };\n    // Called when the path has been successfully loaded as a directory.\n    let loadAsDir = (dir: DirectoryEntry): void => {\n      // Directory entry size can't be determined from the HTML5 FS API, and is\n      // implementation-dependant anyway, so a dummy value is used.\n      let size = 4096;\n      let stat = new Stats(FileType.DIRECTORY, size);\n      cb(null, stat);\n    };\n    // Called when the path couldn't be opened as a directory or a file.\n    let failedToLoad = (err: DOMException): void => {\n      cb(convertError(err, path, false /* Unknown / irrelevant */));\n    };\n    // Called when the path couldn't be opened as a file, but might still be a\n    // directory.\n    let failedToLoadAsFile = (): void => {\n      this.fs.root.getDirectory(path, opts, loadAsDir, failedToLoad);\n    };\n    // No method currently exists to determine whether a path refers to a\n    // directory or a file, so this implementation tries both and uses the first\n    // one that succeeds.\n    this.fs.root.getFile(path, opts, loadAsFile, failedToLoadAsFile);\n  }\n\n  public open(p: string, flags: FileFlag, mode: number, cb: (err: ApiError, fd?: IFile) => any): void {\n    let error = (err: DOMError): void => {\n      if (err.name === 'InvalidModificationError' && flags.isExclusive()) {\n        cb(ApiError.EEXIST(p));\n      } else {\n        cb(convertError(err, p, false));\n      }\n    };\n\n    this.fs.root.getFile(p, {\n      create: flags.pathNotExistsAction() === ActionType.CREATE_FILE,\n      exclusive: flags.isExclusive()\n    }, (entry: FileEntry): void => {\n      // Try to fetch corresponding file.\n      entry.file((file: File): void => {\n        let reader = new FileReader();\n        reader.onloadend = (event: Event): void => {\n          let bfsFile = this._makeFile(p, entry, flags, file, <ArrayBuffer> reader.result);\n          cb(null, bfsFile);\n        };\n        reader.onerror = (ev: Event) => {\n          error(reader.error);\n        };\n        reader.readAsArrayBuffer(file);\n      }, error);\n    }, error);\n  }\n\n  public unlink(path: string, cb: (e?: ApiError) => void): void {\n    this._remove(path, cb, true);\n  }\n\n  public rmdir(path: string, cb: (e?: ApiError) => void): void {\n    // Check if directory is non-empty, first.\n    this.readdir(path, (e, files?) => {\n      if (e) {\n        cb(e);\n      } else if (files.length > 0) {\n        cb(ApiError.ENOTEMPTY(path));\n      } else {\n        this._remove(path, cb, false);\n      }\n    });\n  }\n\n  public mkdir(path: string, mode: number, cb: (e?: ApiError) => void): void {\n    // Create the directory, but throw an error if it already exists, as per\n    // mkdir(1)\n    let opts = {\n      create: true,\n      exclusive: true\n    };\n    let success = (dir: DirectoryEntry): void => {\n      cb();\n    };\n    let error = (err: DOMException): void => {\n      cb(convertError(err, path, true));\n    };\n    this.fs.root.getDirectory(path, opts, success, error);\n  }\n\n  /**\n   * Map _readdir's list of `FileEntry`s to their names and return that.\n   */\n  public readdir(path: string, cb: (err: ApiError, files?: string[]) => void): void {\n    this._readdir(path, (e: ApiError, entries?: Entry[]): void => {\n      if (e) {\n        return cb(e);\n      }\n      let rv: string[] = [];\n      for (let i = 0; i < entries.length; i++) {\n        rv.push(entries[i].name);\n      }\n      cb(null, rv);\n    });\n  }\n\n  /**\n   * Returns a BrowserFS object representing a File, created from the data\n   * returned by calls to the Dropbox API.\n   */\n  private _makeFile(path: string, entry: FileEntry, flag: FileFlag, stat: File, data: ArrayBuffer = new ArrayBuffer(0)): HTML5FSFile {\n    let stats = new Stats(FileType.FILE, stat.size);\n    let buffer = arrayBuffer2Buffer(data);\n    return new HTML5FSFile(this, entry, path, flag, stats, buffer);\n  }\n\n  /**\n   * Returns an array of `FileEntry`s. Used internally by empty and readdir.\n   */\n  private _readdir(path: string, cb: (e: ApiError, entries?: Entry[]) => void): void {\n    let error = (err: DOMException): void => {\n      cb(convertError(err, path, true));\n    };\n    // Grab the requested directory.\n    this.fs.root.getDirectory(path, { create: false }, (dirEntry: DirectoryEntry) => {\n      let reader = dirEntry.createReader();\n      let entries: Entry[] = [];\n\n      // Call the reader.readEntries() until no more results are returned.\n      let readEntries = () => {\n        reader.readEntries(((results) => {\n          if (results.length) {\n            entries = entries.concat(_toArray(results));\n            readEntries();\n          } else {\n            cb(null, entries);\n          }\n        }), error);\n      };\n      readEntries();\n    }, error);\n  }\n\n  /**\n   * Delete a file or directory from the file system\n   * isFile should reflect which call was made to remove the it (`unlink` or\n   * `rmdir`). If this doesn't match what's actually at `path`, an error will be\n   * returned\n   */\n  private _remove(path: string, cb: (e?: ApiError) => void, isFile: boolean): void {\n    let success = (entry: Entry): void => {\n      let succ = () => {\n        cb();\n      };\n      let err = (err: DOMException) => {\n        cb(convertError(err, path, !isFile));\n      };\n      entry.remove(succ, err);\n    };\n    let error = (err: DOMException): void => {\n      cb(convertError(err, path, !isFile));\n    };\n    // Deleting the entry, so don't create it\n    let opts = {\n      create: false\n    };\n\n    if (isFile) {\n      this.fs.root.getFile(path, opts, success, error);\n    } else {\n      this.fs.root.getDirectory(path, opts, success, error);\n    }\n  }\n}\n"]}